needs "compiled_eval.hl";;

let db = add_thms (empty_db ()) 
  ["ARITH_SUC", ARITH_SUC; 
   "ARITH_ADD", ARITH_ADD;
   "ARITH_MULT", ARITH_MULT;
   "ARITH_GE", ARITH_GE;
   "ARITH_GT", ARITH_GT;
  ];;

let r = entries db |> C List.nth 1 |> snd |> compile db;;
print_expr Format.std_formatter r;;

entries db;;
let r = entries db |> hd |> snd;;
print_expr Format.std_formatter @@ compile_prelude r;;
let c = compile_rhs db (hd (r.rewrites));;
print_expr Format.std_formatter c;;


#load "unix.cma";;

let test f n a =
  let start = Unix.gettimeofday() in
  let r = f a in
  for i = 2 to n do
    ignore (f a)
  done;
  let finish = Unix.gettimeofday() in
  r, finish -. start;;

(* 0.277 *)
test f_SUC 10000 `255`;;
(* 0.084 *)
test NUM_SUC_CONV 10000 `SUC 255`;;

test (f_ADD `100`) 10000 `248294`;;
test NUM_ADD_CONV 10000 `100 + 248294`;;